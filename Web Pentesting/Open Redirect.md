
- **Definition:** An **Open Redirect** occurs when an application redirects users to a URL specified by **unvalidated user input** (e.g., query parameter, fragment, meta refresh, or JavaScript).
    
- **Impact:**
    
    - Users are tricked into visiting malicious sites while trusting the original domain.
        
    - Can be chained with **phishing, credential theft, OAuth token leaks, cookie theft, or malware delivery**.
        

---

## 🔄 General Attack Flow

1. Attacker finds a redirect parameter (e.g., `?redirect=`, `?url=`, `?next=`, `?checkout_url=`).
    
2. Application **uses the parameter’s value directly** in an HTTP response or JavaScript snippet.
    
3. Victim clicks a **legit-looking link** on the trusted domain (`example.com`) but gets redirected to attacker’s site (`evil.com`).
    
4. Victim assumes they are still on the trusted domain, increasing chance of phishing success.
    

**Example Flow:**

```
Victim clicks: https://trusted.com/login?redirect=https://evil.com  
Browser request: GET /login?redirect=https://evil.com  
Server response: 302 Found Location: https://evil.com  
Victim → redirected to attacker site.
```

---

## ⚡ Real-World Case Studies

### 1. Shopify Theme Install Open Redirect

- **URL:**
    
    `https://app.shopify.com/services/.../preview/supply-blue?domain_name=attacker.com`
    
- **What Happened:**
    
    - Shopify expected `domain_name` to always be a valid Shopify store.
        
    - Attacker supplied `attacker.com`.
        
    - Victim was redirected to `http://attacker.com/admin`.
        

**Flow:**

1. Victim clicks Shopify theme preview link.
    
2. `domain_name` set to `attacker.com`.
    
3. Shopify redirects user → `attacker.com/admin`.
    

✅ **Full redirect control due to lack of validation.**

---

### 2. Shopify Login Open Redirect

- **URL:**
    
    `http://mystore.myshopify.com/account/login?checkout_url=.attacker.com`
    
- **What Happened:**
    
    - Shopify appended `checkout_url` to its subdomain.
        
    - Final domain became `mystore.myshopify.com.attacker.com`.
        
    - DNS resolves right-to-left → attacker controlled `attacker.com`.
        

**Flow:**

1. Victim clicks crafted login link.
    
2. Browser parses domain → matches `attacker.com`.
    
3. Redirect lands on attacker’s domain.
    

✅ **Partial control via DNS parsing trick.**

---

### 3. HackerOne Interstitial Redirect

- **Setup:** HackerOne used **Zendesk** (`support.hackerone.com`) with an **interstitial warning page**.
    
- **What Happened:**
    
    - Attacker created `company.zendesk.com` (legit Zendesk subdomain).
        
    - Injected JavaScript:
        
        `<script>document.location.href="http://evil.com";</script>`
        
    - HackerOne trusted all `zendesk.com` links and skipped interstitial.
        
    - Victim redirected silently to `evil.com`.
        

**Flow:**

1. Victim clicks link to HackerOne → Zendesk subdomain.
    
2. Zendesk page executes attacker’s injected JS.
    
3. Browser auto-redirects → `evil.com`.
    

✅ **Bypassed interstitial warning using trusted 3rd-party + JS injection.**

---

## 🔑 Key Takeaways

- **Why it’s dangerous:** Users see a trusted domain in the link but end up at attacker’s site.
    
- **Common vulnerable parameters:**
    
    - `redirect=`, `next=`, `url=`, `continue=`, `domain_name=`, `checkout_url=`
        
    - Sometimes short/obscure (`r=`, `u=`).
        
- **Exploitation vectors:**
    
    1. Direct parameter misuse (no validation).
        
    2. DNS tricks (`.attacker.com`).
        
    3. JavaScript/HTML injection (meta refresh, DOM `window.location`).
        
    4. Third-party trust abuse (e.g., Zendesk).
        
- **Defense:**
    
    - Whitelist redirect destinations.
        
    - Don’t allow absolute external URLs in redirect parameters.
        
    - Use interstitial warning pages for external redirects.
        
    - Validate input strictly (regex/domain checks).
        

---

## 🚩 Red Team Usage

- Phishing (look-alike trusted links).
    
- OAuth token theft via crafted redirects.
    
- Chaining with XSS or CSRF to escalate.
    

## 🛡️ Blue Team Checklist

- Monitor for unvalidated redirect parameters.
    
- Enforce strict domain allowlists.
    
- Inspect logs for suspicious `?redirect=` or `?url=` patterns.
    
- Test DNS parsing edge cases (`.evil.com`, `//evil.com`, `@evil.com`).
  
## Resources

Real-World Bug Hunting: A Field Guide to Web Hacking” by Peter Yaworski (No Starch Press, 2019).