
SMB - Server Message Block Protocol - is a client-server communication protocol used for sharing access to files, printers, serial ports and other resources on a network. 

Servers make file systems and other resources (printers, named pipes, APIs) available to clients on the network. Client computers may have their own hard disks, but they also want access to the shared file systems and printers on the servers.

The SMB protocol is known as a response-request protocol, meaning that it transmits multiple messages between the client and server to establish a connection. Clients connect to servers using TCP/IP (actually NetBIOS over TCP/IP as specified in RFC1001 and RFC1002), NetBEUI or IPX/SPX.

**How does SMB work?**  

![](../../../Attachments/Pasted%20image%2020231105005523.png)

Once they have established a connection, clients can then send commands (SMBs) to the server that allow them to access shares, open files, read and write files, and generally do all the sort of things that you want to do with a file system. However, in the case of SMB, these things are done over the network.


**NFS vs SMB Summary:**

- NFS better for Unix/Linux, while SMB better for Windows.
- NFS requires extra tools to support Apple, but SMB does not.
- NFS runs in Unix/Linux and Windows; SMB needs Samba to do so.
- NFS file locking is mandatory or advisory, but SMB locking is mandatory.
- NFS has no fast file find; SMB has fast find.
- NFS no server and printer browsing, while SMB has server and printer browsing.
- NFS slower reads and writes; SMB faster.
- NFS better with small files, while SMB fine with small files but better with large files.

# SMB Exploitation:

There are some vulnerabilities that could be exploited on a samba server like "CVE-2017-7494" which allows remote code execution

**Method Breakdown**

So, from our enumeration `enum4linux [options] ip` stage which is mentioned under [[Enum4Linux#Useful Commands]] section, we know:

    - The SMB share location

    - The name of an interesting SMB share -which is profiles in the example we studied-

Next, we try to connect using Anonymous access by providing `smbclient //[IP]/[SHARE]` which is also mentioned under the [[SMBClient#Useful Commands]] section.

Finally we try to find any interesting files that could give us a flag or an ssh private key.
